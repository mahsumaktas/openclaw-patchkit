# OpenClaw PR patch list — Categorized
# Format: PR_NUMBER | description  [risk:LEVEL] [verified:VERSION]
# Lines starting with # are comments
# Remove a line when the PR gets merged upstream
#
# Risk levels:
#   low      — clean git apply (strategy 1)
#   medium   — needed exclude-test or exclude-changelog strategy
#   high     — has manual script in manual-patches/
#   critical — FIX scripts or disabled patches
#
# Last updated: 2026-02-28
# Base version: v2026.2.26
# Total: 119 active patches + 3 FIX + 1 DISABLED (0 expansions)

# ============================================
# SECURITY PATCHES (14) — Upgrade'de ASLA cikarma
# ============================================
19675 | fix(security): zero-width Unicode boundary marker bypass  [risk:high] [verified:v2026.2.26]
23008 | fix(security): prototype pollution in mergeConfigSection  [risk:medium] [verified:v2026.2.26]
19191 | fix(security): harden cron file permissions to 0o600  [risk:high] [verified:v2026.2.26]
25966 | security(gateway): cap pending pre-auth websocket handshakes  [risk:low] [verified:v2026.2.26]
25973 | security(gateway): reject oversized pre-auth websocket frames  [risk:high] [verified:v2026.2.26]
26544 | fix(security): enforce group chat agent allowlist in routing  [risk:low] [verified:v2026.2.26]
25987 | security: remove agents dir from media serve allowlist  [risk:low] [verified:v2026.2.26]
26337 | security: detect secrets in inbound messages  [risk:low] [verified:v2026.2.26]
26675 | security: neutralize spoofed system messages in user input  [risk:high] [verified:v2026.2.26]
26533 | fix(security): add brute-force protection to pairing code validation  [risk:high] [verified:v2026.2.26]
26555 | fix(security): ignore Discord embed preview text in agent input  [risk:high] [verified:v2026.2.26]
27474 | fix: mask API key snippets in /models and /model status output  [risk:high] [verified:v2026.2.26]
16990 | fix(media): strip auth headers on cross-origin redirect  [risk:low] [verified:v2026.2.26]
16992 | fix(gateway): escape XML in filename prevent prompt injection  [risk:medium] [verified:v2026.2.26]

# ============================================
# GATEWAY/DAEMON FIXES (19) — Platform-critical
# ============================================
24695 | fix(process): pid kill after group kill  [risk:low] [verified:v2026.2.26]
15603 | fix(gateway): correct malformed HTTP 429 on WebSocket upgrade  [risk:high] [verified:v2026.2.26]
19134 | fix(gateway): specify utf-8 encoding on SSE res.write()  [risk:high] [verified:v2026.2.26]
16015 | fix(gateway): truncate oversized message in chat.history  [risk:high] [verified:v2026.2.26]
24763 | fix(gateway): include pairing requestId in close reason and recovery hints  [risk:low] [verified:v2026.2.26]
25299 | fix(daemon): use launchctl kill instead of bootout in gateway stop  [risk:low] [verified:v2026.2.26]
25276 | fix(exec): finalize child runs on exit not delayed stdio close  [risk:low] [verified:v2026.2.26]
26626 | fix(daemon): replace unconditional KeepAlive with SuccessfulExit dict  [risk:high] [verified:v2026.2.26]
26441 | fix(gateway): graceful drain mode for restart/shutdown  [risk:high] [verified:v2026.2.26]
25093 | fix(gateway): hard-bind OpenAI/OpenResponses ingress as external non-owner  [risk:low] [verified:v2026.2.26]
26875 | fix(gateway): undici TLS crash-loop on certificate rejection  [risk:low] [verified:v2026.2.26]
27013 | fix(daemon): kill stale PID before port-conflict restart  [risk:low] [verified:v2026.2.26]
26700 | fix(gateway): strip leaked EXTERNAL_UNTRUSTED_CONTENT wrappers  [risk:low] [verified:v2026.2.26]
18446 | fix(gateway): /healthz endpoint return JSON instead of HTML  [risk:high] [verified:v2026.2.26]
26435 | fix(daemon): LaunchAgent post-update restart with version-aware plist  [risk:high] [verified:v2026.2.26]
22112 | fix(doctor): warn when gateway is network-exposed without TLS  [risk:high] [verified:v2026.2.26]
21842 | fix(gateway-cli): use wss:// scheme when gatewayTls is enabled  [risk:medium] [verified:v2026.2.26]
27272 | fix(sessions): add bootId/pidStartTime to lock files to prevent PID recycling issues  [risk:low] [verified:v2026.2.26]
28247 | bugfix: fix(gateway): fail fast on port-in-use to prevent systemd crash loop  [risk:low] [verified:v2026.2.26]

# ============================================
# SESSION/COMPACTION FIXES (14) — Veri butunlugu
# ============================================
21201 | fix(compaction): repair tool_use/tool_result pairing  [risk:low] [verified:v2026.2.26]
14328 | fix: strip incomplete tool_use blocks prevent 400 loops  [risk:medium] [verified:v2026.2.26]
25381 | fix(agents): preserve thinking blocks in latest assistant during compaction  [risk:high] [verified:v2026.2.26]
26673 | fix(compaction): apply contextTokens cap to SDK shouldCompact trigger  [risk:high] [verified:v2026.2.26]
25169 | fix: drop toolResult with empty/blank call_id prevent session corruption  [risk:low] [verified:v2026.2.26]
24759 | fix(openai): drop orphan tool results after tool-call filtering  [risk:low] [verified:v2026.2.26]
25351 | fix(heartbeat): preserve transcript when heartbeat run made tool calls  [risk:low] [verified:v2026.2.26]
23557 | fix: catch session JSONL write failures instead of crashing  [risk:high] [verified:v2026.2.26]
27142 | fix: drop thinking blocks for Anthropic to prevent session corruption  [risk:low] [verified:v2026.2.26]
16095 | fix: remove orphaned tool_result blocks during compaction  [risk:high] [verified:v2026.2.26]
15050 | fix: transcript corruption resilience (run.ts only — repair.ts covered by #14328)  [risk:high] [verified:v2026.2.26]
28555 | fix(compaction): prevent double-compaction from cache-ttl entry  [risk:low] [verified:v2026.2.26]
22901 | fix: guard against NaN reserveTokens in compaction safeguard  [risk:high] [verified:v2026.2.26]
11986 | fix: drop empty assistant content blocks from error/aborted API responses (death spiral)  [risk:high] [verified:v2026.2.26]

# ============================================
# CHANNEL/PLATFORM FIXES (16) — Kanal-spesifik
# ============================================
24538 | fix(discord): replyToMode first/off delivery  [risk:low] [verified:v2026.2.26]
24500 | fix(telegram): streaming preview on error payload  [risk:low] [verified:v2026.2.26]
22900 | fix(discord): set IS_COMPONENTS_V2 flag for v2 components  [risk:high] [verified:v2026.2.26]
22025 | fix(telegram): accept colon provider ids in mdl_list callbacks  [risk:low] [verified:v2026.2.26]
23184 | fix(auto-reply): prevent reminder guard note leaking into channel messages  [risk:high] [verified:v2026.2.26]
24737 | fix(telegram): record sent messages for reaction own mode filtering  [risk:high] [verified:v2026.2.26]
25974 | fix(discord): break resume death spiral when session goes stale  [risk:low] [verified:v2026.2.26]
27092 | fix(telegram): prevent 401 typing crash from killing bot process  [risk:high] [verified:v2026.2.26]
27207 | fix(typing): add onCleanup to finally blocks preventing indicator leak  [risk:high] [verified:v2026.2.26]
27319 | fix(discord): filter bot-own MESSAGE_CREATE events before debouncer  [risk:low] [verified:v2026.2.26]
16812 | fix: sessions_send failing on Telegram, Discord, Signal, and Slack  [risk:low] [verified:v2026.2.26]
27454 | fix(telegram): prevent crash loop on oversized file attachments  [risk:high] [verified:v2026.2.26]
16995 | fix(telegram): record update ID before processing to prevent crash replay  [risk:high] [verified:v2026.2.26]
27472 | fix(telegram): ensure polling initialization is abortable and retries  [risk:high] [verified:v2026.2.26]
27175 | fix(memory): prevent stuck typing on embedding model switch  [risk:medium] [verified:v2026.2.26]
25280 | fix: sessions_send silent drop when A2A run fails  [risk:low] [verified:v2026.2.26]

# ============================================
# MEMORY FIXES (4) — Arama ve recall
# ============================================
24727 | fix(memory): qmd busy_timeout contention  [risk:low] [verified:v2026.2.26]
12760 | fix(memory-flush): fire on every compaction cycle  [risk:medium] [verified:v2026.2.26]
14005 | fix(memory): bm25RankToScore constant 1.0 for negative ranks  [risk:medium] [verified:v2026.2.26]
25409 | fix(memory): cap hybrid minScore at textWeight preserve BM25-only matches  [risk:low] [verified:v2026.2.26]

# ============================================
# CONFIG/ENV FIXES (12) — Yapilandirma ve ortam
# ============================================
19129 | fix(config): block destructive config writes  [risk:low] [verified:v2026.2.26]
16987 | fix(config): skipCache sessionStore prevent lost updates  [risk:high] [verified:v2026.2.26]
18193 | fix: default elevatedDefault to 'off' instead of 'on'  [risk:medium] [verified:v2026.2.26]
24379 | fix(config): preserve env var refs during gateway startup config writes  [risk:high] [verified:v2026.2.26]
24805 | fix(usage): include archived deleted transcripts in usage-cost totals  [risk:low] [verified:v2026.2.26]
24840a | fix(config): redact env.vars with register(sensitive)  [risk:high] [verified:v2026.2.26]
24840c | fix(cli): rename --url to --cookie-url in cookies set  [risk:high] [verified:v2026.2.26]
22929 | fix: NODE_EXTRA_CA_CERTS missing from LaunchAgent on macOS  [risk:low] [verified:v2026.2.26]
24008 | fix(config): strip unknown keys instead of dropping entire section  [risk:high] [verified:v2026.2.26]
27044 | fix(net): allow network config overrides for pinned dispatchers  [risk:high] [verified:v2026.2.26]
28428 | fix(gateway): stop embedding token in daemon service env to prevent post-rotation drift  [risk:high] [verified:v2026.2.26]
28291 | fix(daemon): forward NODE_EXTRA_CA_CERTS + NODE_USE_SYSTEM_CA to service env  [risk:high] [verified:v2026.2.26]

# ============================================
# BUG/STABILITY FIXES (40) — Genel duzeltmeler
# ============================================
24614 | fix: models.list allowlist respect  [risk:low] [verified:v2026.2.26]
24039 | fix(logging): local time in console timestamps  [risk:low] [verified:v2026.2.26]
24732 | fix(acp): flush delta text on final chat event  [risk:low] [verified:v2026.2.26]
22475 | fix(logging): correct levelToMinLevel mapping to match tslog  [risk:low] [verified:v2026.2.26]
19177 | fix: use parseAgentSessionKey instead of fragile split  [risk:high] [verified:v2026.2.26]
22711 | fix: post-compaction audit skips non-existent files  [risk:low] [verified:v2026.2.26]
21615 | fix(tui): preserve main session model during heartbeat override  [risk:low] [verified:v2026.2.26]
12191 | fix: guard undefined model.input in display and scan  [risk:low] [verified:v2026.2.26]
22424 | fix: prevent crash when onUpdate is truthy but not callable  [risk:low] [verified:v2026.2.26]
17375 | fix(session): don't carry stale model info into reset welcome  [risk:high] [verified:v2026.2.26]
19996 | fix(plugins): bind logger methods to preserve this context  [risk:high] [verified:v2026.2.26]
24764 | fix(failover): classify subscription/plan unavailability as billing  [risk:high] [verified:v2026.2.26]
20990 | fix: handle single-element type arrays in tryFlattenLiteralAnyOf  [risk:low] [verified:v2026.2.26]
16963 | fix: enable auth rate limiting by default  [risk:high] [verified:v2026.2.26]
19406 | fix(heartbeat): filter error payloads from heartbeat reply selection  [risk:low] [verified:v2026.2.26]
14023 | fix: filter skills watcher to relevant file types prevent FD exhaustion  [risk:low] [verified:v2026.2.26]
17950 | fix: filter error payloads from user-facing messages  [risk:medium] [verified:v2026.2.26]
16894 | fix: truncation splitting surrogate pairs in subagents/web-fetch  [risk:high] [verified:v2026.2.26]
25134 | fix: prevent echo loop by coercing isFromMe strings  [risk:low] [verified:v2026.2.26]
25092 | fix(hooks): enforce allowedAgentIds for omitted agentId  [risk:low] [verified:v2026.2.26]
25416 | fix(cron): drain pending writes before reading run log  [risk:low] [verified:v2026.2.26]
25219 | fix(agent): prevent gateway hang on streaming fetch errors  [risk:high] [verified:v2026.2.26]
26565 | fix(cron): normalize jobId to id in store loader to prevent stuck jobs  [risk:low] [verified:v2026.2.26]
25818 | fix: log rotation for /tmp/openclaw gateway logs  [risk:high] [verified:v2026.2.26]
10197 | fix: add missing allowAgents to agent defaults subagents schema  [risk:high] [verified:v2026.2.26]
19407 | fix(agents): strip thinking blocks on cross-provider model switch  [risk:high] [verified:v2026.2.26]
18230 | fix(sessions): repair lone surrogates in session history  [risk:high] [verified:v2026.2.26]
21896 | fix(cron): disable messaging tool when delivery.mode is none  [risk:high] [verified:v2026.2.26]
23525 | fix: include sessionKey in session_start/session_end hook context  [risk:high] [verified:v2026.2.26]
25702 | fix(archive): reject symlink tar extraction roots  [risk:low] [verified:v2026.2.26]
27477 | fix: normalize edit aliases and stabilize mutation fingerprint  [risk:low] [verified:v2026.2.26]
19077 | fix(agents): trigger model failover on connection-refused and network-unreachable errors  [risk:medium] [verified:v2026.2.26]
27388 | fix(agent): retry on Anthropic stream event order errors  [risk:high] [verified:v2026.2.26]
23672 | fix(resilience): guard JSON.parse of external process output with try-catch  [risk:high] [verified:v2026.2.26]
20185 | fix(model): recognize default/reset/clear keywords to clear session model override  [risk:high] [verified:v2026.2.26]
26602 | fix: clean orphaned session lock files on in-process restart  [risk:low] [verified:v2026.2.26]
23777 | fix(delivery): move permanently failed entries out of retry queue  [risk:high] [verified:v2026.2.26]
28514 | fix(agents): enforce Mistral strict9 tool call ID sanitization via OpenAI compat  [risk:low] [verified:v2026.2.26]
28572 | fix(memory): allow FTS-only indexing without embedding provider  [risk:high] [verified:v2026.2.26]
17823 | fix: memory leak in cron isolated runs — agent-events Maps never cleaned  [risk:high] [verified:v2026.2.26]

# ============================================
# PLATFORM-SPECIFIC FIXES (3) — macOS/self-hosted
# ============================================
FIX-A1 | fix(gateway-status): pass tlsFingerprint to probeGateway for self-signed cert  [risk:critical] [verified:v2026.2.26]
FIX-A2 | fix(discord): catch ResilientGatewayPlugin maxAttempts=0 uncaught exception  [risk:critical] [verified:v2026.2.26]
FIX-A3 | fix(gateway): accept self-signed cert for wss:// without fingerprint  [risk:critical] [verified:v2026.2.26]

# ============================================
# DISABLED (1) — Bilinen sorunlu, fix bekliyor
# ============================================
# DISABLED: 28258 — wrapAsyncIterableWithRecovery strips response.result() → crash-loop (agent-loop.js:187)  [risk:critical]
# Needs fix: proxy .result() from original stream before re-enabling

# ============================================
# REMOVED / RETIRED / SKIPPED / DEFERRED
# ============================================
# REMOVED: 20533 — closed upstream in v2026.2.24
# REMOVED: 22022 — senderIsOwner already in base v2026.2.23 (causes TS duplicate identifier)
# REMOVED: 21516 — closed upstream in v2026.2.24
# REMOVED: 20867 — closed upstream in v2026.2.24
# REMOVED: 24571 — merged upstream 2026-02-25
# REMOVED: 24164 — cosmetic label change, zero functional impact (stability audit 2026-02-26)
# REMOVED: 22741 — DashScope/Qwen fix already in base v2026.2.23
# REMOVED: 11160 — audio MIME mappings unused, trivial impact (stability audit 2026-02-26)
# REMOVED: 24300 — closed upstream
# REMOVED: 12499 — closed upstream
# REMOVED: 12792 — closed upstream
# REMOVED: 24806 — merged upstream as #25803 in v2026.2.24
# REMOVED: 23974 — merged upstream
# REMOVED: 21735 — merged upstream as #25485 in v2026.2.24
# REMOVED: 24969 — merged upstream in v2026.2.24
# REMOVED: 25289 — closed, superseded by #24969
# REMOVED: 24840-B network failover — new logic in errors.ts hot path, risky (stability audit 2026-02-26)
# REMOVED: 24517 — feature not bugfix, core pi-tools path risk, never applied (stability audit 2026-02-26)
# REMOVED: 26502 — merged upstream in v2026.2.26
# REMOVED: 26529 — merged upstream in v2026.2.26
# REMOVED: 27021 — upstream v2026.2.26 has 60s TTL + startGuard (typing.ts refactored)
# REMOVED: 26999 — upstream v2026.2.26 has closed/sealed/startGuard race protection
# REMOVED: EXP-1 — Grammy already handles update_id dedup, false positive risk (stability audit 2026-02-26)
# REMOVED: EXP-2 — redundant with #25966 + #25973 + #25093 (stability audit 2026-02-26)
# REMOVED: EXP-3 — redundant with #26626 + #26441 + #27013, 500 lines on startup path (stability audit 2026-02-26)
# REMOVED: EXP-4 — dead code, no channel uses it, YAGNI (stability audit 2026-02-26)
# SKIPPED: 26443 (PID recycling — container only)
# SKIPPED: 26047 (LINE webhook dedupe — unused channel, superseded by EXP-1)
# SKIPPED: 26918 (IRC monitor — unused channel, superseded by EXP-4)
# SKIPPED: 24958 (RubberBand — XL, high maintenance risk)
# SKIPPED: 11746 — meta.lastTouchedAt no-op already in BASE_RELOAD_RULES_TAIL (v2026.2.24)
# SKIPPED: 21622 — already in base v2026.2.24 (READ_SCOPE+WRITE_SCOPE in CLI_DEFAULT_OPERATOR_SCOPES)
# SKIPPED: 22583 — already in base v2026.2.24 (operator.admin satisfies all operator.* scopes)
# SKIPPED: 25988 — merged in v2026.2.25
# SKIPPED: 27593 — superseded in v2026.2.26-beta.1 (typing cross-channel umbrella)
# DEFERRED: 8390 — feature (fallback model notify), lower priority
# DEFERRED: 20622 — feature (typing TTL config), lower priority
# 28238 | DUPLICATE of #25966 — cap pending pre-auth websocket handshakes (already patched)
