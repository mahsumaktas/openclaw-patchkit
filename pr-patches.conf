# OpenClaw PR patch list
# Format: PR_NUMBER | SHORT_DESCRIPTION
# Lines starting with # are comments
# Remove a line when the PR gets merged upstream
#
# Last updated: 2026-02-26
# Base version: v2026.2.24
# Total: 93 active patches + 3 FIX (0 expansions)
# Stability audit: 8 items removed (4 EXP + 3 PR + 1 partial), 1 PR split

# ── Wave 1: Original patches ─────────────────────────────────────────────────
24614 | fix: models.list allowlist respect
24695 | fix(process): pid kill after group kill
24727 | fix(memory): qmd busy_timeout contention
24538 | fix(discord): replyToMode first/off delivery
24500 | fix(telegram): streaming preview on error payload
24039 | fix(logging): local time in console timestamps
24732 | fix(acp): flush delta text on final chat event

# ── Wave 2: Full scan results ─────────────────────────────────────────────────
# git apply clean:
19129 | fix(config): block destructive config writes
# REMOVED: 20533 — closed upstream in v2026.2.24
21201 | fix(compaction): repair tool_use/tool_result pairing
# git apply --exclude tests:
12760 | fix(memory-flush): fire on every compaction cycle
16992 | fix(gateway): escape XML in filename prevent prompt injection
# manual patch:
23557 | fix: catch session JSONL write failures instead of crashing
19675 | fix(security): zero-width Unicode boundary marker bypass
16894 | fix: truncation splitting surrogate pairs in subagents/web-fetch

# ── Wave 3: Comprehensive scan ────────────────────────────────────────────────
# git apply clean:
16990 | fix(media): strip auth headers on cross-origin redirect
22475 | fix(logging): correct levelToMinLevel mapping to match tslog
# REMOVED: 22022 — senderIsOwner already in base v2026.2.23 (causes TS duplicate identifier)
# manual patch (context drift in v2026.2.24):
19177 | fix: use parseAgentSessionKey instead of fragile split
15603 | fix(gateway): correct malformed HTTP 429 on WebSocket upgrade
22711 | fix: post-compaction audit skips non-existent files
21615 | fix(tui): preserve main session model during heartbeat override
12191 | fix: guard undefined model.input in display and scan
22424 | fix: prevent crash when onUpdate is truthy but not callable
# REMOVED: 21516 — closed upstream in v2026.2.24
# manual patch:
19191 | fix(security): harden cron file permissions to 0o600
# git apply --exclude tests:
14005 | fix(memory): bm25RankToScore constant 1.0 for negative ranks
17375 | fix(session): don't carry stale model info into reset welcome
14328 | fix: strip incomplete tool_use blocks prevent 400 loops
# git apply --exclude changelog+tests:
23008 | fix(security): prototype pollution in mergeConfigSection
18193 | fix: default elevatedDefault to 'off' instead of 'on'
# manual patch:
22900 | fix(discord): set IS_COMPONENTS_V2 flag for v2 components
19134 | fix(gateway): specify utf-8 encoding on SSE res.write()
16987 | fix(config): skipCache sessionStore prevent lost updates
16015 | fix(gateway): truncate oversized message in chat.history

# ── Wave 4: Sonnet 4.6 full scan ─────────────────────────────────────────────
# git apply clean:
24764 | fix(failover): classify subscription/plan unavailability as billing
22025 | fix(telegram): accept colon provider ids in mdl_list callbacks
20990 | fix: handle single-element type arrays in tryFlattenLiteralAnyOf
16963 | fix: enable auth rate limiting by default
22929 | fix: NODE_EXTRA_CA_CERTS missing from LaunchAgent on macOS
19406 | fix(heartbeat): filter error payloads from heartbeat reply selection
24763 | fix(gateway): include pairing requestId in close reason and recovery hints
# REMOVED: 20867 — closed upstream in v2026.2.24
14023 | fix: filter skills watcher to relevant file types prevent FD exhaustion
# REMOVED: 24571 — merged upstream 2026-02-25
# REMOVED: 24164 — cosmetic label change, zero functional impact (stability audit 2026-02-26)
24805 | fix(usage): include archived deleted transcripts in usage-cost totals
24379 | fix(config): preserve env var refs during gateway startup config writes
# git apply --exclude tests:
21842 | fix(gateway-cli): use wss:// scheme when gatewayTls is enabled
17950 | fix: filter error payloads from user-facing messages
# REMOVED: 22741 — DashScope/Qwen fix already in base v2026.2.23
# manual patch (was changelog+tests exclude, context drift in types.ts):
23184 | fix(auto-reply): prevent reminder guard note leaking into channel messages
19996 | fix(plugins): bind logger methods to preserve this context
24737 | fix(telegram): record sent messages for reaction own mode filtering
# REMOVED: 11160 — audio MIME mappings unused, trivial impact (stability audit 2026-02-26)

# ── Wave 5: Tier 1 batch (score >= 80, curated-report.json) ──────────────────
# REMOVED: 24300 — closed upstream
# REMOVED: 12499 — closed upstream
# REMOVED: 12792 — closed upstream
# git apply clean:
# REMOVED: 24806 — merged upstream as #25803 in v2026.2.24
# manual patch (doctor-security.ts line mismatch):
22112 | fix(doctor): warn when gateway is network-exposed without TLS
# REMOVED: 23974 — merged upstream
23525 | fix: include sessionKey in session_start/session_end hook context
# manual patch (run.ts line shift):
21896 | fix(cron): disable messaging tool when delivery.mode is none
# manual patch (llm-slug-generator.ts import changes):
# REMOVED: 21735 — merged upstream as #25485 in v2026.2.24

# ── Wave 6: Deep review batch (reviewed & approved) ─────────────────────────
# REMOVED: 24969 — merged upstream in v2026.2.24
# REMOVED: 25289 — closed, superseded by #24969
# git apply clean:
25299 | fix(daemon): use launchctl kill instead of bootout in gateway stop
25134 | fix: prevent echo loop by coercing isFromMe strings
25092 | fix(hooks): enforce allowedAgentIds for omitted agentId
25169 | fix: drop toolResult with empty/blank call_id prevent session corruption
24759 | fix(openai): drop orphan tool results after tool-call filtering
25416 | fix(cron): drain pending writes before reading run log
25409 | fix(memory): cap hybrid minScore at textWeight preserve BM25-only matches
25276 | fix(exec): finalize child runs on exit not delayed stdio close
25351 | fix(heartbeat): preserve transcript when heartbeat run made tool calls

# ── Wave 7: High-risk manual patches ────────────────────────────────────────
# manual patch (split from bundled #24840 — network failover removed, stability audit 2026-02-26):
24840a | fix(config): redact env.vars with register(sensitive)
24840c | fix(cli): rename --url to --cookie-url in cookies set
# REMOVED: 24840-B network failover — new logic in errors.ts hot path, risky (stability audit 2026-02-26)
# manual patch (selective: thinking.ts only from 12-file PR):
25381 | fix(agents): preserve thinking blocks in latest assistant during compaction
# REMOVED: 24517 — feature not bugfix, core pi-tools path risk, never applied (stability audit 2026-02-26)

# ── Wave 8: Nightly Scan Batch (10 active, 4 skipped) ─────────────────────
26626 | fix(daemon): replace unconditional KeepAlive with SuccessfulExit dict
26441 | fix(gateway): graceful drain mode for restart/shutdown
25093 | fix(gateway): hard-bind OpenAI/OpenResponses ingress as external non-owner
25966 | security(gateway): cap pending pre-auth websocket handshakes
25973 | security(gateway): reject oversized pre-auth websocket frames
25219 | fix(agent): prevent gateway hang on streaming fetch errors
26565 | fix(cron): normalize jobId to id in store loader to prevent stuck jobs
26544 | fix(security): enforce group chat agent allowlist in routing
26502 | fix(agents): prevent double compaction from destroying preserved messages
25974 | fix(discord): break resume death spiral when session goes stale
# SKIPPED: 26443 (PID recycling — container only)
# SKIPPED: 26047 (LINE webhook dedupe — unused channel, superseded by EXP-1)
# SKIPPED: 26918 (IRC monitor — unused channel, superseded by EXP-4)
# SKIPPED: 24958 (RubberBand — XL, high maintenance risk)

# ── Wave 9: Targeted fixes (5 clean + 1 manual, 1 skipped) ────────────────
# git apply clean:
26875 | fix(gateway): undici TLS crash-loop on certificate rejection
27013 | fix(daemon): kill stale PID before port-conflict restart
26529 | fix(agents): clear stale totalTokens after compaction
25987 | security: remove agents dir from media serve allowlist
26700 | fix(gateway): strip leaked EXTERNAL_UNTRUSTED_CONTENT wrappers
# manual patch (typing.ts context drift):
27021 | fix(typing): add keepalive failsafe timer
# SKIPPED: 11746 — meta.lastTouchedAt no-op already in BASE_RELOAD_RULES_TAIL (v2026.2.24)

# ── Wave 10: Analysis Report Batch (6 active, 2 skipped) ──────────────────
# git apply clean:
26337 | security: detect secrets in inbound messages
27044 | fix(net): allow network config overrides for pinned dispatchers
# git apply --exclude tests (closed upstream but fix still valuable):
26999 | fix(typing): prevent keepalive loop restart after cleanup during async race
# manual patch:
10197 | fix: add missing allowAgents to agent defaults subagents schema
19407 | fix(agents): strip thinking blocks on cross-provider model switch
18230 | fix(sessions): repair lone surrogates in session history
# SKIPPED: 21622 — already in base v2026.2.24 (READ_SCOPE+WRITE_SCOPE in CLI_DEFAULT_OPERATOR_SCOPES)
# SKIPPED: 22583 — already in base v2026.2.24 (operator.admin satisfies all operator.* scopes)

# ── Wave 11: Critical Fixes + Security Hardening (8 manual patches) ─────
# manual patch (user critical pain point):
27092 | fix(telegram): prevent 401 typing crash from killing bot process
26435 | fix(daemon): LaunchAgent post-update restart with version-aware plist
25818 | fix: log rotation for /tmp/openclaw gateway logs
18446 | fix(gateway): /healthz endpoint return JSON instead of HTML
# manual patch (security hardening):
26675 | security: neutralize spoofed system messages in user input
# manual patch (compaction + delivery fixes):
26673 | fix(compaction): apply contextTokens cap to SDK shouldCompact trigger
23777 | fix(delivery): move permanently failed entries out of retry queue
24008 | fix(config): strip unknown keys instead of dropping entire section

# ── Wave 12: Stability Fixes ─────────────────────────────────────────────
# manual patch (typing leak — all 4 channels):
27207 | fix(typing): add onCleanup to finally blocks preventing indicator leak
# manual patch (discord reconnect crash):
FIX-A2 | fix(discord): catch ResilientGatewayPlugin maxAttempts=0 uncaught exception
# manual patch (TLS probe fix):
FIX-A1 | fix(gateway-status): pass tlsFingerprint to probeGateway for self-signed cert
# manual patch (wss self-signed fallback):
FIX-A3 | fix(gateway): accept self-signed cert for wss:// without fingerprint

# ── Expansions (ALL REMOVED — stability audit 2026-02-26) ─────────────────
# Individual PRs cover each case. Custom expansions added risk without proven need.
# REMOVED: EXP-1 — Grammy already handles update_id dedup, false positive risk (stability audit 2026-02-26)
# REMOVED: EXP-2 — redundant with #25966 + #25973 + #25093 (stability audit 2026-02-26)
# REMOVED: EXP-3 — redundant with #26626 + #26441 + #27013, 500 lines on startup path (stability audit 2026-02-26)
# REMOVED: EXP-4 — dead code, no channel uses it, YAGNI (stability audit 2026-02-26)
